import requests
import re
from pwn import log as o
import socket
import subprocess as sub
from typing import Tuple

# Función para buscar un patrón en el contenido de una URL
def fetch_and_search(url: str, search_pattern: str) -> str:
    try:
        response = requests.get(url, timeout=5)
        response.raise_for_status()
        for line in response.text.splitlines():
            if re.search(search_pattern, line):
                return line.strip()
    except requests.RequestException as e:
        print(f"[!] Error al conectar con {url}: {e}")
    except Exception as e:
        print(f"[!] Error inesperado: {e}")

# Función para descubrir hosts mediante ICMP (ping)
def scan_icmp(ip: str) -> str:
    try:
        result = sub.run(
            ["ping", "-c", "1", "-W", "1", ip],
            timeout=2,
            stdout=sub.DEVNULL,
            stderr=sub.DEVNULL
        )
        return f"La IP {ip} está activa" if result.returncode == 0 else f"La IP {ip} no está activa"
    except sub.TimeoutExpired:
        return f"[!] Tiempo de espera agotado al hacer ping a {ip}"
    except Exception as e:
        return f"[!] Error inesperado al hacer ping a {ip}: {e}"